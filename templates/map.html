<!doctype html>
<html lang="ja">

<head>
    {% include "_head.html" %}
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Map</title>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        main {
            height: calc(100vh - 4rem);
            width: 100%;
        }

        #drawer {
            transition: transform .25s ease;
        }

        #drawer.closed {
            transform: translateX(100%);
        }
    </style>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/routes_view_minimized.css') }}">
     <!-- map-picker のスタイル（マップページ専用） -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/map-picker.css') }}">
    <!-- 旅ピンのルート表示CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/journey-style.css') }}">
</head>

<body>

    {% include "components/header.html" %}

    <!-- メイン（地図） -->
    <main class="pt-16">
        <div id="map" tabindex="-1"></div>
    </main>

    <!-- ピン関連モーダル（存在するファイル名に修正） -->
    {% include "components/map-modals.html" %}

    {% include "components/drawer.html" %}
    {% include "components/route.html" %}
    {% include "components/routes_view.html" %}

    <!-- map 初期化とピン取得等の本体スクリプト（このファイルが最初に map を作る） -->
    <script src="{{ url_for('static', filename='js/map-init.js') }}"></script>

    <!-- 機能別スクリプト（map-init.js の後で読み込む） -->
    <script src="{{ url_for('static', filename='js/route.js') }}"></script>
    <script src="{{ url_for('static', filename='js/routes_view.js') }}"></script>
    <script src="{{ url_for('static', filename='js/routes_view_minimized.js') }}"></script>

        <!-- 追加: routes_view_minimized の補助的修正（endViewingJourneys の確実なバインド） -->
    <script src="{{ url_for('static', filename='js/routes_view_minimized.fix.js') }}"></script>
    <!-- 旅ピンの補正 -->
    <script src="{{ url_for('static', filename='js/journey-style.js') }}"></script>
    <script src="{{ url_for('static', filename='js/map-layer-toggle.js') }}"></script>
</body>

</html>
